-- == Object Hitbox Extender for Roblox ==
-- Author: Colin
-- Description: Extend hitbox for objects, items, and parts with Rayfield UI

local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Window = Rayfield:CreateWindow({
    Name = "Object Hitbox Extender",
    LoadingTitle = "Object Hitbox Extender",
    LoadingSubtitle = "by Colin",
    ConfigurationSaving = {
        Enabled = true,
        FolderName = "ObjectHitbox",
        FileName = "Config"
    },
    Discord = {
        Enabled = false,
        Invite = "noinvite",
        RememberJoins = true
    },
    KeySystem = false,
})

local MainTab = Window:CreateTab("Object Settings", 4483362458)
local FilterTab = Window:CreateTab("Object Filter", 4483362458)
local VisualTab = Window:CreateTab("Visuals", 4483362458)

-- A. MAIN OBJECT HITBOX SETTINGS
local ObjectSection = MainTab:CreateSection("Object Hitbox Configuration")

local ObjectSize = MainTab:CreateSlider({
    Name = "Object Hitbox Size",
    Range = {1, 20},
    Increment = 0.5,
    Suffix = "x",
    CurrentValue = 1,
    Flag = "ObjectSize",
    Callback = function(Value)
        getgenv().ObjectHitboxMultiplier = Value
    end,
})

local ObjectDistance = MainTab:CreateSlider({
    Name = "Max Distance",
    Range = {10, 500},
    Increment = 10,
    Suffix = "studs",
    CurrentValue = 100,
    Flag = "ObjectDistance",
    Callback = function(Value)
        getgenv().MaxObjectDistance = Value
    end,
})

local ToggleObjectHitbox = MainTab:CreateToggle({
    Name = "Enable Object Hitbox",
    CurrentValue = false,
    Flag = "ObjectHitboxEnabled",
    Callback = function(Value)
        getgenv().ObjectHitboxEnabled = Value
        if Value then
            StartObjectHitbox()
        else
            StopObjectHitbox()
        end
    end,
})

-- B. OBJECT FILTER SETTINGS
local FilterSection = FilterTab:CreateSection("Object Filtering")

local ObjectTypes = FilterTab:CreateDropdown({
    Name = "Target Object Types",
    Options = {"All Objects", "Tools Only", "Weapons Only", "Items Only", "Parts Only", "Custom Names"},
    CurrentOption = "All Objects",
    Flag = "ObjectTypes",
    Callback = function(Option)
        getgenv().TargetObjectTypes = Option
    end,
})

local CustomNames = FilterTab:CreateInput({
    Name = "Custom Object Names",
    PlaceholderText = "Sword,Gun,Coin,Key",
    Flag = "CustomNames",
    Callback = function(Text)
        getgenv().CustomObjectNames = Text
    end,
})

local IncludeDescendants = FilterTab:CreateToggle({
    Name = "Include Descendant Objects",
    CurrentValue = true,
    Flag = "IncludeDescendants",
    Callback = function(Value)
        getgenv().IncludeDescendants = Value
    end,
})

local WhitelistMode = FilterTab:CreateToggle({
    Name = "Whitelist Mode (Only Selected)",
    CurrentValue = false,
    Flag = "WhitelistMode",
    Callback = function(Value)
        getgenv().WhitelistMode = Value
    end,
})

-- C. VISUAL SETTINGS
local VisualSection = VisualTab:CreateSection("Hitbox Visuals")

local ShowObjectHitbox = VisualTab:CreateToggle({
    Name = "Show Object Hitbox Visual",
    CurrentValue = true,
    Flag = "ShowObjectHitbox",
    Callback = function(Value)
        getgenv().ShowObjectHitboxVisual = Value
    end,
})

local HitboxTransparency = VisualTab:CreateSlider({
    Name = "Hitbox Transparency",
    Range = {0.1, 1},
    Increment = 0.1,
    Suffix = "",
    CurrentValue = 0.3,
    Flag = "HitboxTransparency",
    Callback = function(Value)
        getgenv().HitboxTransparency = Value
    end,
})

local HitboxColor = VisualTab:CreateColorPicker({
    Name = "Hitbox Color",
    Color = Color3.fromRGB(0, 255, 0),
    Flag = "HitboxColor",
    Callback = function(Color)
        getgenv().HitboxColor = Color
    end
})

-- D. OBJECT HITBOX EXTENSION FUNCTIONS
function ShouldExtendObject(object)
    if not object:IsA("BasePart") then return false end
    
    local objectName = object.Name:lower()
    local objectType = getgenv().TargetObjectTypes or "All Objects"
    local customNames = getgenv().CustomObjectNames or ""
    
    -- Distance check
    local localPlayer = game:GetService("Players").LocalPlayer
    local character = localPlayer.Character
    if character and character:FindFirstChild("HumanoidRootPart") then
        local distance = (character.HumanoidRootPart.Position - object.Position).Magnitude
        if distance > (getgenv().MaxObjectDistance or 100) then
            return false
        end
    end
    
    -- Object type filtering
    if getgenv().WhitelistMode then
        -- Only extend objects in whitelist
        if objectType == "Custom Names" then
            local names = {}
            for name in customNames:gmatch("[^,]+") do
                table.insert(names, name:lower():trim())
            end
            for _, name in pairs(names) do
                if objectName:find(name) then
                    return true
                end
            end
            return false
        end
    else
        -- Blacklist mode (extend all except excluded)
        if objectType == "Tools Only" then
            return object:IsA("Tool") or objectName:find("tool") or objectName:find("sword") or objectName:find("axe")
        elseif objectType == "Weapons Only" then
            return objectName:find("gun") or objectName:find("weapon") or objectName:find("rifle") or objectName:find("pistol")
        elseif objectType == "Items Only" then
            return objectName:find("item") or objectName:find("coin") or objectName:find("key") or objectName:find("health")
        elseif objectType == "Parts Only" then
            return object:IsA("Part") and not object:IsA("Tool")
        elseif objectType == "Custom Names" then
            local names = {}
            for name in customNames:gmatch("[^,]+") do
                table.insert(names, name:lower():trim())
            end
            for _, name in pairs(names) do
                if objectName:find(name) then
                    return true
                end
            end
            return false
        end
    end
    
    return objectType == "All Objects"
end

function CreateHitboxVisual(object)
    if not getgenv().ShowObjectHitboxVisual then return end
    if object:FindFirstChild("HitboxVisual") then return end
    
    local hitboxVisual = Instance.new("BoxHandleAdornment")
    hitboxVisual.Name = "HitboxVisual"
    hitboxVisual.Adornee = object
    hitboxVisual.AlwaysOnTop = true
    hitboxVisual.ZIndex = 5
    hitboxVisual.Size = object.Size * (getgenv().ObjectHitboxMultiplier or 1)
    hitboxVisual.Transparency = getgenv().HitboxTransparency or 0.3
    hitboxVisual.Color3 = getgenv().HitboxColor or Color3.fromRGB(0, 255, 0)
    hitboxVisual.Parent = object
end

function RemoveHitboxVisual(object)
    local visual = object:FindFirstChild("HitboxVisual")
    if visual then
        visual:Destroy()
    end
end

function ExtendObjectHitbox(object)
    if not ShouldExtendObject(object) then return end
    
    -- Store original size if not already stored
    if not object:GetAttribute("OriginalSize") then
        object:SetAttribute("OriginalSize", object.Size)
    end
    
    -- Apply hitbox extension
    local multiplier = getgenv().ObjectHitboxMultiplier or 1
    object.Size = object:GetAttribute("OriginalSize") * multiplier
    
    -- Create visual
    CreateHitboxVisual(object)
end

function ResetObjectHitbox(object)
    local originalSize = object:GetAttribute("OriginalSize")
    if originalSize then
        object.Size = originalSize
    end
    RemoveHitboxVisual(object)
end

-- E. MAIN LOOP
local ObjectHitboxConnection
function StartObjectHitbox()
    local RunService = game:GetService("RunService")
    local Workspace = game:GetService("Workspace")
    
    -- Initialize variables
    getgenv().ObjectHitboxMultiplier = getgenv().ObjectHitboxMultiplier or 1
    getgenv().MaxObjectDistance = getgenv().MaxObjectDistance or 100
    getgenv().ShowObjectHitboxVisual = getgenv().ShowObjectHitboxVisual or true
    
    -- Scan and extend existing objects
    local function ScanObjects(parent)
        for _, object in pairs(parent:GetChildren()) do
            if object:IsA("BasePart") then
                ExtendObjectHitbox(object)
            end
            
            if getgenv().IncludeDescendants then
                ScanObjects(object)
            end
        end
    end
    
    -- Initial scan
    ScanObjects(Workspace)
    
    -- Continuous monitoring for new objects
    ObjectHitboxConnection = RunService.Heartbeat:Connect(function()
        if not getgenv().ObjectHitboxEnabled then return end
        
        -- Scan workspace for new objects
        for _, object in pairs(Workspace:GetChildren()) do
            if object:IsA("BasePart") and not object:GetAttribute("HitboxProcessed") then
                object:SetAttribute("HitboxProcessed", true)
                ExtendObjectHitbox(object)
            end
        end
    end)
    
    -- Monitor object additions
    Workspace.DescendantAdded:Connect(function(descendant)
        if not getgenv().ObjectHitboxEnabled then return end
        if descendant:IsA("BasePart") then
            task.wait(0.1) -- Small delay to ensure object is fully loaded
            ExtendObjectHitbox(descendant)
        end
    end)
end

function StopObjectHitbox()
    if ObjectHitboxConnection then
        ObjectHitboxConnection:Disconnect()
    end
    
    -- Reset all objects
    local Workspace = game:GetService("Workspace")
    local function ResetObjects(parent)
        for _, object in pairs(parent:GetChildren()) do
            if object:IsA("BasePart") then
                ResetObjectHitbox(object)
            end
            
            if getgenv().IncludeDescendants then
                ResetObjects(object)
            end
        end
    end
    
    ResetObjects(Workspace)
end

-- F. QUICK PRESETS
local PresetSection = MainTab:CreateSection("Quick Presets")

MainTab:CreateButton({
    Name = "Small Objects (3x)",
    Callback = function()
        ObjectSize:Set(3)
        Rayfield:Notify({
            Title = "Preset Applied",
            Content = "Small object hitbox activated",
            Duration = 2
        })
    end,
})

MainTab:CreateButton({
    Name = "Medium Objects (6x)",
    Callback = function()
        ObjectSize:Set(6)
        Rayfield:Notify({
            Title = "Preset Applied",
            Content = "Medium object hitbox activated",
            Duration = 2
        })
    end,
})

MainTab:CreateButton({
    Name = "Large Objects (10x)",
    Callback = function()
        ObjectSize:Set(10)
        Rayfield:Notify({
            Title = "Preset Applied",
            Content = "Large object hitbox activated",
            Duration = 2
        })
    end,
})

-- G. INITIALIZE
Rayfield:Notify({
    Title = "Object Hitbox Extender Loaded",
    Content = "Configure object filters and enable when ready!",
    Duration = 5,
    Image = 4483362458
})

-- Initialize global variables
getgenv().ObjectHitboxEnabled = false
getgenv().ObjectHitboxMultiplier = 1
getgenv().MaxObjectDistance = 100
getgenv().TargetObjectTypes = "All Objects"
getgenv().ShowObjectHitboxVisual = true
